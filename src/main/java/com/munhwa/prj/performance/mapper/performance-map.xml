<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.munhwa.prj.performance.mapper.PerformanceMapper">
	<resultMap type="com.munhwa.prj.performance.vo.PerformanceVO" id="performanceResultMap">
		<id property="id" column="id"/>
		<result property="name" column="name"/>
		<result property="location" column="location"/>
		<result property="sdate" column="sdate"/>
		<result property="edate" column="edate"/>
		<result property="content" column="content"/>
		<result property="status" column="status"/>
		<result property="image" column="image"/>
		<result property="artistId" column="artist_id"/>
		<result property="price" column="price"/>
		<result property="person" column="person"/>
	</resultMap>
	
	<select id="performanceSelectList" resultMap="performanceResultMap">
		<![CDATA[
		SELECT	ID
		,		NAME
		,		LOCATION
		,		SDATE
		,		EDATE
		,		CONTENT
		,		STATUS
		,		IMAGE
		,		ARTIST_ID
		,		PRICE
		,		PERSON
		FROM	(SELECT ROWNUM AS RN
		,		ID
		,		NAME
		,		LOCATION
		,		SDATE
		,		EDATE
		,		CONTENT
		,		STATUS
		,		IMAGE
		,		ARTIST_ID
		,		PRICE
		,		PERSON
		FROM PERFORMANCE 
		WHERE ROWNUM <= #{pageNum} * #{amount}
		]]>
		<if test="keyword != null">
			AND NAME LIKE '%'||#{keyword}||'%'
		</if>
		ORDER BY SDATE DESC
		)
		<![CDATA[
		WHERE RN > (#{pageNum} -1) * #{amount} 
		]]>
	</select>
	
	<select id="getTotal" resultType="int">
    
        SELECT COUNT(*) FROM PERFORMANCE
        
        <if test="keyword != null">
        	WHERE NAME LIKE '%'||#{keyword}||'%'
        </if>
    
    </select>
	
	
	<select id="performanceSelect" parameterType="com.munhwa.prj.performance.vo.PerformanceVO" resultMap="performanceResultMap">
		SELECT	P.ID
		,		P.NAME
		,		P.LOCATION
		,		P.SDATE
		,		P.EDATE
		,		P.CONTENT
		,		P.STATUS
		,		P.IMAGE
		,		P.ARTIST_ID
		,		P.PRICE
		,		P.PERSON - PP.PERSONAL AS PERSON
		FROM	PERFORMANCE P, PERFORMANCE_PERSONAL PP
		WHERE   P.ID = #{id}
		AND		P.ID = PP.ID
	</select>
	
	<insert id="performanceInsert" parameterType="com.munhwa.prj.performance.vo.PerformanceVO">
		INSERT INTO PERFORMANCE(ID, NAME, LOCATION, SDATE, EDATE, CONTENT, IMAGE, PRICE, ARTIST_ID)
		VALUES(PERFORMANCE_SEQ.nextval, #{name}, #{location}, #{sdate}, #{edate}, #{content}, #{image}, #{price}, #{artistId})
	</insert>


	
	<update id="performanceUpdate" statementType="CALLABLE" parameterType="map">
		<![CDATA[
			{ call accept_performance (
				#{v_per_id, mode=IN, jdbcType=INTEGER, javaType=int}
			)}
		]]>
	</update>
	
</mapper>