<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.munhwa.prj.post.mapper.PostMapper">
  <insert id="insertPost">
    INSERT INTO post (id, title, writer, content, created_at, hit, like_it, member_id,
                      file_group_id)
    VALUES (post_seq.nextval, #{title}, #{writer}, #{content}, #{createdAt}, 0, 0, #{memberId},
            #{fileGroupId})
  </insert>

  <update id="updatePost">
    update post
    <set>
      <if test="title != null">title = #{title}</if>
      <if test="content != null">content = #{content}</if>
    </set>
    where id = #{id}
  </update>

  <delete id="deletePostById">
    DELETE
    FROM post
    WHERE id = #{id}
  </delete>

  <select id="selectPosts" resultType="com.munhwa.prj.post.vo.PostVO">
    SELECT *
    FROM post
    ORDER BY created_at DESC
  </select>

  <select id="selectPostById" resultType="com.munhwa.prj.post.vo.PostVO">
    SELECT *
    FROM post
    WHERE id = #{id}
  </select>

  <select id="selectPostsByFilter" resultType="com.munhwa.prj.post.vo.PostVO">
    select *
    from post
    <where>
      <if test="filter.equal(member)">AND member_id = #{memberId}</if>
      <if test="filter.equal(nickname)">AND writer = #{writer}</if>
      <if test="filter.equal(title)">AND title = #{title}</if>
    </where>
    <choose>
      <when test="filter.equal(asc)">
        <if test="value.equal(hit)">order by hit asc</if>
        <if test="value.equal(likeIt)">order by like_it asc</if>
        <if test="value.equal(createdAt)">order by created_at asc</if>
      </when>
      <when test="filter.equal(desc)">
        <if test="value.equal(hit)">order by hit desc</if>
        <if test="value.equal(likeIt)">order by like_it desc</if>
        <if test="value.equal(createdAt)">order by created_at desc</if>
      </when>
      <otherwise>
        order by created_at desc
      </otherwise>
    </choose>
  </select>
</mapper>