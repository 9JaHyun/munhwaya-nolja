<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.munhwa.prj.member.mapper.MemberMapper">

	<resultMap type="com.munhwa.prj.member.vo.MemberVO" id="memberResultMap">
		<id property="id" column="id" />
		<result property="password" column="password" />
		<result property="nickname" column="nickname" />
		<result property="tel" column="tel" />
		<result property="mileage" column="mileage"/>
		<result property="genre" column="genre" />
	</resultMap>

	<!-- 마이페이지 회원정보 -->
	<select id="selectByMemberId"
		resultType="com.munhwa.prj.member.vo.MemberVO">
		SELECT ID, PASSWORD, NICKNAME, TEL, GENRE, ROLE, MILEAGE, ONAME, SNAME
		FROM MEMBER
		WHERE ID = #{username}
	</select>

	<!-- 개인정보 업데이트 -->
	<update id="updateInfo" parameterType="com.munhwa.prj.member.vo.MemberVO">
		UPDATE MEMBER
		SET TEL = #{tel},
		GENRE = #{genre}
		WHERE ID = #{id}
	</update>
	
	<!-- 프로필 업데이트 (사진, 닉네임) -->
	<update id="updateProfile" parameterType="com.munhwa.prj.member.vo.MemberVO">
		UPDATE MEMBER
		SET ONAME = #{oname}, 
			SNAME = #{sname}, 
			NICKNAME = #{nickname}
		WHERE ID = #{id}
	</update>

	<!-- 비밀번호 업데이트 -->
	<update id="updatePassword"
		parameterType="com.munhwa.prj.member.vo.MemberVO">
		UPDATE MEMBER
		SET PASSWORD = #{password}
		WHERE ID = #{id}
	</update>

	<!-- 회원탈퇴 -->
	<delete id="deleteMember"
		parameterType="com.munhwa.prj.member.vo.MemberVO">
		DELETE FROM MEMBER
		WHERE ID = #{id}
	</delete>

	<select id="deleteMember2"
		parameterType="com.munhwa.prj.member.vo.MemberVO">
		SELECT ID, PASSWORD
		FROM MEMBER
		WHERE ID = #{id} AND
		PASSWORD = #{password}
	</select>

	<!-- 회원가입 -->
	<insert id="memberSignup"
		parameterType="com.munhwa.prj.member.vo.MemberVO">
		INSERT INTO member (id, password, nickname, tel, genre, mileage, role,
		image)
		VALUES (#{id}, #{password}, #{nickname}, #{tel}, #{genre}, 0, #{role},
		#{image})
	</insert>

	<!-- 소셜 로그인 시 회원가입 처리 -->
	<insert id="memberOAuthSignup" statementType="CALLABLE"
		parameterType="map">
	<![CDATA[
    { call saveMember (
      #{v_id, mode=IN, jdbcType=VARCHAR, javaType=string},
      #{v_password, mode=IN, jdbcType=VARCHAR, javaType=string},
      #{v_nickname, mode=IN, jdbcType=VARCHAR, javaType=string},
      #{v_tel, mode=IN, jdbcType=VARCHAR, javaType=string},
      #{v_genre, mode=IN, jdbcType=VARCHAR, javaType=string},
      #{v_image, mode=IN, jdbcType=VARCHAR, javaType=string}
      )}
    ]]>
	</insert>

	<!-- 아이디 중복체크 -->
	<select id="idChk" parameterType="string" resultType="int">
		SELECT COUNT(*)
		FROM member
		WHERE id = #{id}
	</select>

	<!-- 닉네임 중복체크 -->
	<select id="nickChk" parameterType="string" resultType="int">
		SELECT COUNT(*)
		FROM member
		WHERE nickname = #{nickname}
	</select>
</mapper>
